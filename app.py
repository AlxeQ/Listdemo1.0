# -*- coding: utf-8 -*-
import streamlit as st
from openai import OpenAI

st.set_page_config(page_title="è®¿è°ˆæçº²ç”Ÿæˆå™¨", layout="wide")
st.title("ğŸ§© è®¿è°ˆæçº²ç”Ÿæˆå™¨ï¼ˆDeepSeekç‰ˆï¼‰")

# ====== API Key è¾“å…¥ ======
with st.sidebar:
    st.markdown("### è®¾ç½®")
    api_key = st.text_input("è¯·è¾“å…¥ DeepSeek API Key", type="password")
    base_url = st.text_input("API Base URL", "https://api.deepseek.com/v1")
    model = st.selectbox("é€‰æ‹©æ¨¡å‹", ["deepseek-chat", "deepseek-reasoner"], index=0)

# ====== ç”¨æˆ·è¾“å…¥ ======
st.markdown("### è¾“å…¥ä¿¡æ¯")
subject_name = st.text_input("è®¿è°ˆå¯¹è±¡å§“å", "å¼ ä¸‰")
subject_role = st.text_input("å¯¹è±¡è§’è‰²/å¤´è¡”", "åº—ä¸œ")
topic = st.text_input("ä¸»é¢˜", "å›¢é˜Ÿç®¡ç†")
interview_goal = st.text_area("è®¿è°ˆç›®æ ‡", "åŠå¹´å†…ä»8äººæ‰©åˆ°20äººä¸”æµå¤±ç‡<10%")
audience = st.text_input("å—ä¼—", "å•†åœˆç»ç†/è¯¾ç¨‹ç ”å‘")

# ====== æç¤ºè¯ï¼ˆè¯¦ç»†ç‰ˆï¼‰ ======
SYSTEM_PROMPT = """ä½ æ˜¯ä¸€åä¸“ä¸šçš„ã€è¯¾ç¨‹ç ”å‘ç¼–è¾‘ã€‘ï¼Œé•¿æœŸè´Ÿè´£å°†æ ‡æ†äººç‰©çš„ä¸šåŠ¡ç»éªŒè½¬åŒ–ä¸ºå¯å¤åˆ¶çš„è¯¾ç¨‹å†…å®¹ã€‚
ä½ çš„ä»»åŠ¡æ˜¯ï¼šæ ¹æ®è¾“å…¥çš„è®¿è°ˆå¯¹è±¡ã€è§’è‰²ã€ä¸»é¢˜å’Œç›®æ ‡ï¼Œç”Ÿæˆä¸€ä»½å®Œæ•´çš„è®¿è°ˆæçº²ã€‚

ã€ç¡¬æ€§è¦æ±‚ã€‘
- å¿…é¡»è¾“å‡º Markdown æ ¼å¼
- å¿…é¡»åŒ…å«ä»¥ä¸‹ 6 ä¸ªç« èŠ‚ï¼ˆé€å­—ä¸€è‡´ï¼‰ï¼š
  ## ä¸€ã€è®¿è°ˆç›®æ ‡ï¼ˆå¯¹é½ï¼‰
  ## äºŒã€æ—¶é—´åˆ†é…ï¼ˆæ€»æ—¶é•¿ 60 åˆ†é’Ÿå¯è°ƒï¼‰
  ## ä¸‰ã€å…³é”®åœºæ™¯æ·±æŒ–
  ## å››ã€ä¸»æŒäººæç¤ºè¯­
  ## äº”ã€é£é™©ä¸çº¢æ——
  ## å…­ã€ç¼ºå¤±è¯æ®æ¸…å•
- è‹¥ä¿¡æ¯ä¸è¶³ï¼Œä¸å¾—è·³è¿‡ç« èŠ‚ï¼Œç”¨ã€å¾…è¡¥ã€‘å ä½

ã€å†™ä½œè§„åˆ™ã€‘
1. **è®¿è°ˆç›®æ ‡**  
   - ç”¨ç®€æ˜æ‰¼è¦çš„æ¡ç›®ï¼Œå¯¹é½ç ”å‘å›¢é˜Ÿä¸è®¿è°ˆå¯¹è±¡çš„å…±è¯†ã€‚
   - è¾“å‡ºåº”åŒ…å«â€œç›®æ ‡æ‹†è§£ã€é¢„æœŸæˆæœã€å…³é”®è¾“å‡ºç‰©â€ã€‚

2. **æ—¶é—´åˆ†é…**  
   - åˆç†åˆ†é… 60 åˆ†é’Ÿçš„è®¿è°ˆæ—¶é—´åˆ°ä¸åŒç¯èŠ‚ï¼ˆå¯¼å…¥ã€åœºæ™¯æ·±æŒ–ã€æ–¹æ³•æ²‰æ·€ã€æ€»ç»“ï¼‰ã€‚
   - è¾“å‡ºè¡¨æ ¼å½¢å¼ï¼Œæ˜ç¡®æ¯ä¸ªç¯èŠ‚æ‰€éœ€æ—¶é—´ã€‚

3. **å…³é”®åœºæ™¯æ·±æŒ–**  
   - è‡³å°‘ 3 ä¸ªåœºæ™¯ï¼Œæ¯ä¸ªåœºæ™¯åŒ…å«ï¼šè§¦å‘æ¡ä»¶ã€å…³é”®éšœç¢ã€æˆåŠŸæ ‡å‡†ã€åŠ¨ä½œæ¸…å•ï¼ˆåŠ¨è¯-å¯¹è±¡-é¢‘ç‡-æ ‡å‡†-å·¥å…·/ç¤ºä¾‹ï¼‰ã€å¯æ›¿ä»£æ–¹æ¡ˆã€‚
   - åŠ¨ä½œé¢—ç²’åº¦ç¤ºä¾‹ï¼šâ€œæ¯å‘¨2æ¬¡-CRM-è·Ÿè¿›å®¢æˆ·-7æ—¥å†…å®Œæˆâ€ã€‚
   - è¾“å‡ºè¡¨æ ¼å½¢å¼ã€‚

4. **ä¸»æŒäººæç¤ºè¯­**  
   - æ¯ä¸ªé—®é¢˜å‰å…ˆè¿›è¡Œæ€»ç»“æˆ–è‚¯å®šï¼Œå†è‡ªç„¶è¿‡æ¸¡åˆ°è¿½é—®ã€‚
   - è¯­æ°”ç¤¼è²Œå‹å¥½ï¼Œçªå‡ºäº’åŠ¨æ€§å’Œæƒ…ç»ªä»·å€¼ã€‚
   - ç¤ºä¾‹ï¼šâ€œæ‚¨æåˆ°å¸¦æ•™ SOPï¼Œè¿™éå¸¸å…³é”®ã€‚èƒ½ä¸èƒ½å¸¦æˆ‘ä»¬å…·ä½“èµ°ä¸€éåŠ¨ä½œç»†èŠ‚ï¼Ÿâ€

5. **é£é™©ä¸çº¢æ——**  
   - è¾“å‡ºä¸€å¼ è¡¨æ ¼ï¼Œåˆ—å‡ºå¸¸è§é£é™©ï¼ˆå¦‚ï¼šåªæœ‰ç»“è®ºæ²¡æœ‰è¯æ®ã€åªè°ˆä¸ªä¾‹ä¸è°ˆSOPã€æŒ‡æ ‡å£å¾„ä¸ç»Ÿä¸€ï¼‰ï¼Œå¹¶æä¾›ä¸»æŒäººå¯¹ç­–ã€‚

6. **ç¼ºå¤±è¯æ®æ¸…å•**  
   - è¾“å‡ºè‡³å°‘ 5 æ¡ï¼Œæé†’ç ”å‘äººå‘˜å“ªäº›æ•°æ®ã€æ¡ˆä¾‹ã€åŠ¨ä½œè¿˜éœ€è¡¥å……ï¼Œä¾¿äºåç»­å®Œå–„ã€‚
"""

# ====== ç”Ÿæˆé€»è¾‘ ======
if st.button("ç”Ÿæˆè®¿è°ˆæçº²", type="primary"):
    if not api_key:
        st.error("è¯·å…ˆåœ¨å·¦ä¾§è¾“å…¥ DeepSeek API Key")
    else:
        client = OpenAI(api_key=api_key, base_url=base_url)

        user_prompt = f"""
è®¿è°ˆå¯¹è±¡ï¼š{subject_name}ï¼ˆ{subject_role}ï¼‰
ä¸»é¢˜ï¼š{topic}
è®¿è°ˆç›®æ ‡ï¼š{interview_goal}
å—ä¼—ï¼š{audience}
"""

        with st.spinner("ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™..."):
            resp = client.chat.completions.create(
                model=model,
                messages=[
                    {"role": "system", "content": SYSTEM_PROMPT},
                    {"role": "user", "content": user_prompt}
                ],
                max_tokens=3000,
                temperature=0.3,
            )
            outline = resp.choices[0].message.content

        st.markdown("### ğŸ“‘ è¾“å‡ºç»“æœ")
        st.markdown(outline)
        st.download_button("ä¸‹è½½æçº²", outline, file_name="outline.md", mime="text/markdown")
